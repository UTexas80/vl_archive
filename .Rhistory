dt[order(TKR, EXPDAY,  STRIKE), group := rleid(TKR)]
dt[order(TKR, EXPDAY,  STRIKE), group := rleid(STRIKE)]
dt[order(TKR, EXPDAY,  STRIKE), group := rleid(TKR, STRIKE)]
dt[order(TKR, EXPDAY,  STRIKE), group := rleid(TKR, EXPDAY, STRIKE)]
dt[order(TKR, EXPDAY,  STRIKE), group := rleid(TKR, EXPDAY, 'C/P', STRIKE)]
dt[order(TKR, EXPDAY,  STRIKE), group := rleid(TKR, EXPDAY, "'C/P'", STRIKE)]
dt[order(TKR, EXPDAY,  STRIKE), group := rleid(TKR, EXPDAY, dt[[2]], STRIKE)]
dt[order(TKR, EXPDAY,  STRIKE), group := rleid(TKR, EXPDAY, dt[[2]])]
dt[order(TKR, EXPDAY,  STRIKE), group := rleid(TKR, dt[[2]])]
dt[order(TKR, EXPDAY,  STRIKE), group := rleid(TKR, STRIKE, dt[[2]])]
dt[, stk_incrmt := fcase(
shift(OPTKR, type = "lag",  n = 1L) ==  1,
shift(OPTKR, type = "lead", n = 1L) == -1,
shift(OPTKR, type = "lag",  n = 2L) ==  2,
shift(OPTKR, type = "lead", n = 2L) == -2,
shift(OPTKR, type = "lag",  n = 3L) ==  3,
shift(OPTKR, type = "lead", n = 3L) == -3,
), .SDcols = c("OPTKR"), .I]
l<-dt
l
l[,-6]
l
l<-l[,-6]
l <- setorder(l, TKR, sEXPDAY, 'C/P', STRIKE)
l <- setorder(l, TKR, EXPDAY, 'C/P', STRIKE)
l
l[, strike_prev := shift(STRIKE)]
l[, strike_prev_2 := shift(STRIKE, type = "lag", n = 2)]
l[, strike_next := shift(STRIKE, type = "lead")]
l[, strike_next_2 := shift(STRIKE, type = "lead", n = 2)]
l
l[OPTKR=="",]
na.omit(l)
na.omit(l[OPTKR=="",])
l[l[[2]=='P', strike_prev := shift(STRIKE)]
l[l[[2]]=='P', strike_prev := shift(STRIKE)]
l[l[[2]]=='P',]
l[l[[2]]=='P',][, strike_prev := shift(STRIKE)]
l[l[[2]]=='P',][, strike_0 := shift(STRIKE)]
l[l[[2]]=='P',][, strike_0 := shift(STRIKE, type = 'lag')]
l[l[[2]]=='P',][, strike_00 := shift(STRIKE, type = 'lag')]
l[l[[2]]=='P',][, strike_0 := shift(STRIKE, type = 'lead')]
rm(l)
dt <- data.table::setorder(
rbind(
rbind(dx_ticker[dx_tkr_stk, on = .(TKR), roll = Inf, nomatch = 0][
, by = .(TKR, dx_tkr_stk[[2]], EXPDAY), .SD[.N]][
, c("STRIKE", "OPTKR") := .(CMPRICE, "")][
,c(1,5:7,3)]),
dx_tkr_stk),
TKR, EXPDAY, 'C/P', STRIKE
)
l <- dt
l[l[[2]]=='P',][, c(strike_lead0P := shift(STRIKE, type = 'lead'), strike_lag0 := shift(STRIKE, type = 'lag')]
l[l[[2]]=='P',][, c(strike_lead0P := shift(STRIKE, type = 'lead'), strike_lag0 := shift(STRIKE, type = 'lag'))]
l
l[l[[2]]=='P',][, c("strike_lead_0_P", "strike_lag_0_P") := .(shift(STRIKE, type = 'lead'), shift(STRIKE, type = 'lag')))]
l[l[[2]]=='P',][, c("strike_lead_0_P", "strike_lag_0_P") := .(shift(STRIKE, type = 'lead'), shift(STRIKE, type = 'lag'))]
l[TKR=='AA',]
l[l[[2]]=='P',][, c("strike_lead_0_P", "strike_lag_0_P") := .(shift(STRIKE, type = 'lead'), shift(STRIKE, type = 'lag'))][TKR=='AA',]
l[l[[2]]=='C',][, c("strike_lead_0_C", "strike_lag_0_C") := .(shift(STRIKE, type = 'lead'), shift(STRIKE, type = 'lag'))][TKR=='AA',]
l[l[[2]]=='C',][, c("strike_lead_0_C", "strike_lag_0_C", "strike_lead_1_C") := .(shift(STRIKE, type = 'lead'), shift(STRIKE, type = 'lag'),shift(STRIKE, type = "lead", n = 2))][TKR=='AA',]
l[l[[2]]=='C',][, c("strike_lead_0_C", "strike_lag_0_C", "strike_lead_1_C") := .(shift(STRIKE, type = 'lead'), shift(STRIKE, type = 'lag'),shift(STRIKE, type = "lead", n = 2))][TKR=='AA' & OPTKR == "",]
l[l[[2]]=='P',][, c("strike_lead_0_P", "strike_lag_0_P") := .(shift(STRIKE, type = 'lead'), shift(STRIKE, type = 'lag'))][TKR=='AA',]
source("~/github/vl_archive/vl_archive.r", echo=TRUE)
renv::status()
renv::snapshot()
renv::status()
pak::pkg_install('gaborcsardi/async')
pak::pkg_install('AustralianAntarcticDivision/bgmfiles')
pak::pkg_install('ianjonsen/bsam')
renv::status()
taskscheduleR:::taskschedulerAddin()
source("~/github/vl_archive/vl_archive.r", echo=TRUE)
View(dx_tkr_stk)
viewxl:::view_in_xl()
View(s_minus_1)
viewxl:::view_in_xl()
renv::status()
renv::snapshot()
renv::status()
renv::snapshot()
pak::pkg_install('rich-iannone/pointblank')
renv::status()
pak::pkg_install('nteetor/zeallot')
renv::status()
renv::snapshot()
source("~/github/vl_archive/vl_archive.r", echo=TRUE)
glimpse(dx_stk)
View(dx_stk)
dt[, .N,  by = .(TKR, dt[[2]], EXPDAY)][N>4,]
dt_stk[, .N,  by = .(TKR, dt[[2]], EXPDAY)][N>4,]
dx_stk[, .N,  by = .(TKR, dt[[2]], EXPDAY)][N>4,]
dx_stk[, .N,  by = .(TKR, dx_stk[[2]], EXPDAY)][N>4,]
l <- dx_stk
l[l[[2]]=='P',by = .(TKR, l[[2]], EXPDAY)][, c("strike_lead_0_P", "strike_lag_0_P") := .(shift(STRIKE, type = 'lead'), shift(STRIKE, type = 'lag'))][TKR=='AA',]
l[l[[2]]=='C',by = .(TKR, l[[2]], EXPDAY][, c(
# ------------------------------------------------------------------------------lag_1_c
"lag_1_optkr",
"lag_1_stk",
"lag_1_pct_chg",
# ------------------------------------------------------------------------------lag_0_c
"lag_0_optkr",
"lag_0_stk",
"lag_0_pct_chg",
# ------------------------------------------------------------------------------lead_0_c
"lead_0_optkr",
"lead_0_stk",
"lead_0_pct_chg",
# ------------------------------------------------------------------------------
"lead_1_optkr",
"lead_1_stk",
"lead_1_pct_chg") :=
# ------------------------------------------------------------------------------lag_1_c
.(shift(OPTKR,    type = 'lag', n = 2),
shift(STRIKE,   type = 'lag', n = 2),
(STRIKE - shift(STRIKE, type = "lag", n = 2)) /
shift(STRIKE, type = "lag", n = 2) * 100,
# ------------------------------------------------------------------------------lag_0_c
shift(OPTKR,    type = 'lag', n = 1),
shift(STRIKE,   type = 'lag', n = 1),
(STRIKE - shift(STRIKE, type = "lag", n = 1)) /
shift(STRIKE, type = "lag", n = 1) * 100,
# ------------------------------------------------------------------------------lead_0_c
shift(OPTKR,    type = 'lead', n = 1),
shift(STRIKE,   type = 'lead', n = 1),
(STRIKE - shift(STRIKE, type = "lead", n = 1)) /
shift(STRIKE, type = "lead", n = 1) * 100,
# ------------------------------------------------------------------------------lead_1_c
shift(OPTKR,    type = "lead", n = 2),
shift(STRIKE,   type = "lead", n = 2),
(STRIKE - shift(STRIKE, type = "lead", n = 2)) /
shift(STRIKE, type = "lead", n = 2) * 100
)][
TKR=='AA' & OPTKR == "",]
l[l[[2]]=='C',by = .(TKR, l[[2]], EXPDAY]
l[l[[2]]=='P',by = .(TKR, l[[2]], EXPDAY)][, c("strike_lead_0_P", "strike_lag_0_P") := .(shift(STRIKE, type = 'lead'), shift(STRIKE, type = 'lag'))][TKR=='AA',]
l
l <- dx_stk
l <- data.table::setorder(
rbind(
rbind(dx_ticker[dx_tkr_stk, on = .(TKR), roll = Inf, nomatch = 0][
, by = .(TKR, dx_tkr_stk[[2]], EXPDAY), .SD[.N]][
, c("STRIKE", "OPTKR") := .(CMPRICE, "")][
,c(1,5:7,3)]),
dx_tkr_stk),
TKR, EXPDAY, 'C/P', STRIKE
)
l[l[[2]]=='C', by = .(TKR, dt[[2]], EXPDAY]
l[l[[2]]=='C', by = .(TKR, dt[[2]], EXPDAY)]
l[l[[2]]=='C', by = .(TKR, dt[[2]], EXPDAY)][, c(
# ------------------------------------------------------------------------------lag_1_c
"lag_1_optkr",
"lag_1_stk",
"lag_1_pct_chg",
# ------------------------------------------------------------------------------lag_0_c
"lag_0_optkr",
"lag_0_stk",
"lag_0_pct_chg",
# ------------------------------------------------------------------------------lead_0_c
"lead_0_optkr",
"lead_0_stk",
"lead_0_pct_chg",
# ------------------------------------------------------------------------------
"lead_1_optkr",
"lead_1_stk",
"lead_1_pct_chg") :=
# ------------------------------------------------------------------------------lag_1_c
.(shift(OPTKR,    type = 'lag', n = 2),
shift(STRIKE,   type = 'lag', n = 2),
(STRIKE - shift(STRIKE, type = "lag", n = 2)) /
shift(STRIKE, type = "lag", n = 2) * 100,
# ------------------------------------------------------------------------------lag_0_c
shift(OPTKR,    type = 'lag', n = 1),
shift(STRIKE,   type = 'lag', n = 1),
(STRIKE - shift(STRIKE, type = "lag", n = 1)) /
shift(STRIKE, type = "lag", n = 1) * 100,
# ------------------------------------------------------------------------------lead_0_c
shift(OPTKR,    type = 'lead', n = 1),
shift(STRIKE,   type = 'lead', n = 1),
(STRIKE - shift(STRIKE, type = "lead", n = 1)) /
shift(STRIKE, type = "lead", n = 1) * 100,
# ------------------------------------------------------------------------------lead_1_c
shift(OPTKR,    type = "lead", n = 2),
shift(STRIKE,   type = "lead", n = 2),
(STRIKE - shift(STRIKE, type = "lead", n = 2)) /
shift(STRIKE, type = "lead", n = 2) * 100
)][
TKR=='AA' & OPTKR == "",]
l[l[[2]]=='P', by = .(TKR, dt[[2]], EXPDAY)][, c(
# ------------------------------------------------------------------------------lag_1_c
"lag_1_optkr",
"lag_1_stk",
"lag_1_pct_chg",
# ------------------------------------------------------------------------------lag_0_c
"lag_0_optkr",
"lag_0_stk",
"lag_0_pct_chg",
# ------------------------------------------------------------------------------lead_0_c
"lead_0_optkr",
"lead_0_stk",
"lead_0_pct_chg",
# ------------------------------------------------------------------------------
"lead_1_optkr",
"lead_1_stk",
"lead_1_pct_chg") :=
# ------------------------------------------------------------------------------lag_1_c
.(shift(OPTKR,    type = 'lag', n = 2),
shift(STRIKE,   type = 'lag', n = 2),
(STRIKE - shift(STRIKE, type = "lag", n = 2)) /
shift(STRIKE, type = "lag", n = 2) * 100,
# ------------------------------------------------------------------------------lag_0_c
shift(OPTKR,    type = 'lag', n = 1),
shift(STRIKE,   type = 'lag', n = 1),
(STRIKE - shift(STRIKE, type = "lag", n = 1)) /
shift(STRIKE, type = "lag", n = 1) * 100,
# ------------------------------------------------------------------------------lead_0_c
shift(OPTKR,    type = 'lead', n = 1),
shift(STRIKE,   type = 'lead', n = 1),
(STRIKE - shift(STRIKE, type = "lead", n = 1)) /
shift(STRIKE, type = "lead", n = 1) * 100,
# ------------------------------------------------------------------------------lead_1_c
shift(OPTKR,    type = "lead", n = 2),
shift(STRIKE,   type = "lead", n = 2),
(STRIKE - shift(STRIKE, type = "lead", n = 2)) /
shift(STRIKE, type = "lead", n = 2) * 100
)][
TKR=='AA' & OPTKR == "",]
Q
source("~/github/vl_archive/vl_archive.r", echo=TRUE)
dx_stk <-
rbind(
rbind(dx_ticker[dx_tkr_stk, on = .(TKR), roll = Inf, nomatch = 0][
, by = .(TKR, dx_tkr_stk[[2]], EXPDAY), .SD[.N]][
, c("STRIKE", "OPTKR") := .(CMPRICE, "")][
,c(1,5:7,3)]),
dx_tkr_stk
)  %>%
order(TKR, EXPDAY, 'C/P', STRIKE) %>%
split(., by = .(TKR, dx_tkr_stk[[2]], EXPDAY)) %>%
map(., fun_3100_bfly_processing)
rbind(
rbind(dx_ticker[dx_tkr_stk, on = .(TKR), roll = Inf, nomatch = 0][
, by = .(TKR, dx_tkr_stk[[2]], EXPDAY), .SD[.N]][
, c("STRIKE", "OPTKR") := .(CMPRICE, "")][
,c(1,5:7,3)]),
dx_tkr_stk
)  %>%
order(TKR, EXPDAY, 'C/P', STRIKE)
rbind(
rbind(dx_ticker[dx_tkr_stk, on = .(TKR), roll = Inf, nomatch = 0][
, by = .(TKR, dx_tkr_stk[[2]], EXPDAY), .SD[.N]][
, c("STRIKE", "OPTKR") := .(CMPRICE, "")][
,c(1,5:7,3)]),
dx_tkr_stk
)
rbind(
rbind(dx_ticker[dx_tkr_stk, on = .(TKR), roll = Inf, nomatch = 0][
, by = .(TKR, dx_tkr_stk[[2]], EXPDAY), .SD[.N]][
, c("STRIKE", "OPTKR") := .(CMPRICE, "")][
,c(1,5:7,3)]),
dx_tkr_stk
)  %>%
order(TKR, EXPDAY, 'C/P', STRIKE)
dx_stk <- data.table::setorder(
rbind(
rbind(dx_ticker[dx_tkr_stk, on = .(TKR), roll = Inf, nomatch = 0][
, by = .(TKR, dx_tkr_stk[[2]], EXPDAY), .SD[.N]][
, c("STRIKE", "OPTKR") := .(CMPRICE, "")][
,c(1,5:7,3)]),
dx_tkr_stk),
TKR, EXPDAY, 'C/P', STRIKE)
dx_stk
dx_stk <- data.table::setorder(
rbind(
rbind(dx_ticker[dx_tkr_stk, on = .(TKR), roll = Inf, nomatch = 0][
, by = .(TKR, dx_tkr_stk[[2]], EXPDAY), .SD[.N]][
, c("STRIKE", "OPTKR") := .(CMPRICE, "")][
,c(1,5:7,3)]),
dx_tkr_stk),
TKR, EXPDAY, 'C/P', STRIKE)  %>%
dx_stk  %>%
split(., by = .(TKR, dx_tkr_stk[[2]], EXPDAY)) %>%
map(., fun_3100_bfly_processing)
dx_stk <- data.table::setorder(
rbind(
rbind(dx_ticker[dx_tkr_stk, on = .(TKR), roll = Inf, nomatch = 0][
, by = .(TKR, dx_tkr_stk[[2]], EXPDAY), .SD[.N]][
, c("STRIKE", "OPTKR") := .(CMPRICE, "")][
,c(1,5:7,3)]),
dx_tkr_stk),
TKR, EXPDAY, 'C/P', STRIKE)
dx_stk  %>%
split(., by = .(TKR, dx_tkr_stk[[2]], EXPDAY)) %>%
map(., fun_3100_bfly_processing)
dx_stk  %>%
split(., by = .(TKR, EXPDAY)) %>%
map(., fun_3100_bfly_processing)
dx_stk  %>%
split(., by = .(TKR, EXPDAY))
dx_stk
dx_stk  %>%
map(., fun_3100_bfly_processing)
dx_stk <- data.table::setorder(
rbind(
rbind(dx_ticker[dx_tkr_stk, on = .(TKR), roll = Inf, nomatch = 0][
, by = .(TKR, dx_tkr_stk[[2]], EXPDAY), .SD[.N]][
, c("STRIKE", "OPTKR") := .(CMPRICE, "")][
,c(1,5:7,3)]),
dx_tkr_stk),
TKR, EXPDAY, 'C/P', STRIKE)
dx_stk
dx_stk  %>%
split(., by = c("TKR", "EXPDAY")) %>%
map(., fun_4100_bfly_processing)
dx_stk  %>%
split(., by = c("TKR", "EXPDAY")) %>%
map(., fun_3100_bfly_processing)
dx_stk  %>%
split(., by = c("TKR", "EXPDAY")) %>%
map(., fun_3100_bfly_processing)
rlang::last_error()
rlang::last_trace()
fun_3100_bfly_processing    <- function(blob) {
#...............................................................................
browser()
#...............................................................................
}
dx_stk  %>%
split(., by = c("TKR", "EXPDAY")) %>%
map(., fun_3100_bfly_processing)
View(blob)
dx_stk  %>%
split(., by = .(TKR, dx_tkr_stk[[2]], EXPDAY))  %>%
map(., fun_3100_bfly_processing)
dx_stk  %>%
split(., by = .(TKR,  EXPDAY))  %>%
map(., fun_3100_bfly_processing)
dx_stk  %>%
split(., by = c("TKR", "EXPDAY")) %>%
map(., fun_3100_bfly_processing)
dx_stk  %>%
split(., by = c("TKR", "EXPDAY")) %>%
map(., fun_3100_bfly_processing)
Q
dx_stk  %>%
split(., by = c("TKR", "EXPDAY", 'C/P')) %>%
map(., fun_3100_bfly_processing)
fun_3100_bfly_processing    <- function(l) {
#...............................................................................
browser()
#...............................................................................
l[l[[2]]=='C',][, c(
# ------------------------------------------------------------------------------lag_1_c
"lag_1_optkr",
"lag_1_stk",
"lag_1_pct_chg",
# ------------------------------------------------------------------------------lag_0_c
"lag_0_optkr",
"lag_0_stk",
"lag_0_pct_chg",
# ------------------------------------------------------------------------------lead_0_c
"lead_0_optkr",
"lead_0_stk",
"lead_0_pct_chg",
# ------------------------------------------------------------------------------
"lead_1_optkr",
"lead_1_stk",
"lead_1_pct_chg") :=
# ------------------------------------------------------------------------------lag_1_c
.(shift(OPTKR,    type = 'lag', n = 2),
shift(STRIKE,   type = 'lag', n = 2),
(STRIKE - shift(STRIKE, type = "lag", n = 2)) /
shift(STRIKE, type = "lag", n = 2) * 100,
# ------------------------------------------------------------------------------lag_0_c
shift(OPTKR,    type = 'lag', n = 1),
shift(STRIKE,   type = 'lag', n = 1),
(STRIKE - shift(STRIKE, type = "lag", n = 1)) /
shift(STRIKE, type = "lag", n = 1) * 100,
# ------------------------------------------------------------------------------lead_0_c
shift(OPTKR,    type = 'lead', n = 1),
shift(STRIKE,   type = 'lead', n = 1),
(STRIKE - shift(STRIKE, type = "lead", n = 1)) /
shift(STRIKE, type = "lead", n = 1) * 100,
# ------------------------------------------------------------------------------lead_1_c
shift(OPTKR,    type = "lead", n = 2),
shift(STRIKE,   type = "lead", n = 2),
(STRIKE - shift(STRIKE, type = "lead", n = 2)) /
shift(STRIKE, type = "lead", n = 2) * 100
)][
TKR=='AA' & OPTKR == "",]
#...............................................................................
browser()
#...............................................................................
}
dx_stk  %>%
split(., by = c("TKR", "EXPDAY", 'C/P')) %>%
map(., fun_3100_bfly_processing)
l
fun_3100_bfly_processing    <- function(l) {
#...............................................................................
browser()
#...............................................................................
l[l[[2]]=='C',][, c(
# ------------------------------------------------------------------------------lag_1_c
"lag_1_optkr",
"lag_1_stk",
"lag_1_pct_chg",
# ------------------------------------------------------------------------------lag_0_c
"lag_0_optkr",
"lag_0_stk",
"lag_0_pct_chg",
# ------------------------------------------------------------------------------lead_0_c
"lead_0_optkr",
"lead_0_stk",
"lead_0_pct_chg",
# ------------------------------------------------------------------------------
"lead_1_optkr",
"lead_1_stk",
"lead_1_pct_chg") :=
# ------------------------------------------------------------------------------lag_1_c
.(shift(OPTKR,    type = 'lag', n = 2),
shift(STRIKE,   type = 'lag', n = 2),
(STRIKE - shift(STRIKE, type = "lag", n = 2)) /
shift(STRIKE, type = "lag", n = 2) * 100,
# ------------------------------------------------------------------------------lag_0_c
shift(OPTKR,    type = 'lag', n = 1),
shift(STRIKE,   type = 'lag', n = 1),
(STRIKE - shift(STRIKE, type = "lag", n = 1)) /
shift(STRIKE, type = "lag", n = 1) * 100,
# ------------------------------------------------------------------------------lead_0_c
shift(OPTKR,    type = 'lead', n = 1),
shift(STRIKE,   type = 'lead', n = 1),
(STRIKE - shift(STRIKE, type = "lead", n = 1)) /
shift(STRIKE, type = "lead", n = 1) * 100,
# ------------------------------------------------------------------------------lead_1_c
shift(OPTKR,    type = "lead", n = 2),
shift(STRIKE,   type = "lead", n = 2),
(STRIKE - shift(STRIKE, type = "lead", n = 2)) /
shift(STRIKE, type = "lead", n = 2) * 100
)][
TKR=='AA' & OPTKR == "",]
#...............................................................................
browser()
#...............................................................................
}
dx_stk  %>%
split(., by = c("TKR", "EXPDAY", 'C/P')) %>%
map(., fun_3100_bfly_processing)
l
source("~/github/vl_archive/vl_archive.r", echo=TRUE)
l
l[l[[2]]=='C',][, c(
# ------------------------------------------------------------------------------lag_1_c
"lag_1_optkr",
"lag_1_stk",
"lag_1_pct_chg",
# ------------------------------------------------------------------------------lag_0_c
"lag_0_optkr",
"lag_0_stk",
"lag_0_pct_chg",
# ------------------------------------------------------------------------------lead_0_c
"lead_0_optkr",
"lead_0_stk",
"lead_0_pct_chg",
# ------------------------------------------------------------------------------
"lead_1_optkr",
"lead_1_stk",
"lead_1_pct_chg") :=
# ------------------------------------------------------------------------------lag_1_c
.(shift(OPTKR,    type = 'lag', n = 2),
shift(STRIKE,   type = 'lag', n = 2),
(STRIKE - shift(STRIKE, type = "lag", n = 2)) /
shift(STRIKE, type = "lag", n = 2) * 100,
# ------------------------------------------------------------------------------lag_0_c
shift(OPTKR,    type = 'lag', n = 1),
shift(STRIKE,   type = 'lag', n = 1),
(STRIKE - shift(STRIKE, type = "lag", n = 1)) /
shift(STRIKE, type = "lag", n = 1) * 100,
# ------------------------------------------------------------------------------lead_0_c
shift(OPTKR,    type = 'lead', n = 1),
shift(STRIKE,   type = 'lead', n = 1),
(STRIKE - shift(STRIKE, type = "lead", n = 1)) /
shift(STRIKE, type = "lead", n = 1) * 100,
# ------------------------------------------------------------------------------lead_1_c
shift(OPTKR,    type = "lead", n = 2),
shift(STRIKE,   type = "lead", n = 2),
(STRIKE - shift(STRIKE, type = "lead", n = 2)) /
shift(STRIKE, type = "lead", n = 2) * 100
)][
TKR=='AA' & OPTKR == "",]
source("~/github/vl_archive/vl_archive.r", echo=TRUE)
dx_stk
data.table::setorder(
rbind(
rbind(dx_ticker[dx_tkr_stk, on = .(TKR), roll = Inf, nomatch = 0][
, by = .(TKR, dx_tkr_stk[[2]], EXPDAY), .SD[.N]][
, c("STRIKE", "OPTKR") := .(CMPRICE, "")][
,c(1,5:7,3)]),
dx_tkr_stk),
TKR, EXPDAY, 'C/P', STRIKE
)
z<-data.table::setorder(
rbind(
rbind(dx_ticker[dx_tkr_stk, on = .(TKR), roll = Inf, nomatch = 0][
, by = .(TKR, dx_tkr_stk[[2]], EXPDAY), .SD[.N]][
, c("STRIKE", "OPTKR") := .(CMPRICE, "")][
,c(1,5:7,3)]),
dx_tkr_stk),
TKR, EXPDAY, 'C/P', STRIKE
)
z
